<Window x:Class="Wslr.App.Dialogs.ScriptExecutionDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Running Setup Script"
        Height="450" Width="650"
        WindowStartupLocation="CenterOwner"
        WindowStyle="None"
        AllowsTransparency="False"
        ResizeMode="CanResize"
        MinHeight="300" MinWidth="450"
        Background="{StaticResource BackgroundBrush}"
        Closing="Window_Closing">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="32"
                      CornerRadius="8"
                      GlassFrameThickness="0"
                      ResizeBorderThickness="6"
                      UseAeroCaptionButtons="False" />
    </WindowChrome.WindowChrome>

    <Border BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="8">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="32" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Title Bar -->
            <Grid Grid.Row="0" Background="{StaticResource BackgroundBrush}">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="12,0,0,0">
                    <TextBlock Text="&#xE943;"
                               FontFamily="Segoe MDL2 Assets"
                               FontSize="12"
                               Foreground="{StaticResource AccentBrush}"
                               VerticalAlignment="Center"
                               Margin="0,0,8,0" />
                    <TextBlock Text="{Binding Title}"
                               Foreground="{StaticResource SecondaryTextBrush}"
                               FontFamily="{StaticResource MonoFontFamily}"
                               FontSize="12"
                               VerticalAlignment="Center" />
                </StackPanel>
            </Grid>

            <!-- Content -->
            <Grid Grid.Row="1" Margin="16">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Status -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                    <TextBlock Text="Distribution:"
                               Foreground="{StaticResource MutedTextBrush}"
                               FontFamily="{StaticResource MonoFontFamily}"
                               FontSize="11"
                               VerticalAlignment="Center"
                               Margin="0,0,8,0" />
                    <TextBlock Text="{Binding DistributionName}"
                               Foreground="{StaticResource PrimaryTextBrush}"
                               FontFamily="{StaticResource MonoFontFamily}"
                               FontSize="11"
                               FontWeight="SemiBold"
                               VerticalAlignment="Center"
                               Margin="0,0,20,0" />
                    <TextBlock Text="Status:"
                               Foreground="{StaticResource MutedTextBrush}"
                               FontFamily="{StaticResource MonoFontFamily}"
                               FontSize="11"
                               VerticalAlignment="Center"
                               Margin="0,0,8,0" />
                    <TextBlock Text="{Binding StatusText}"
                               FontFamily="{StaticResource MonoFontFamily}"
                               FontSize="11"
                               VerticalAlignment="Center">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="{StaticResource WarningBrush}" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsComplete}" Value="True">
                                        <Setter Property="Foreground" Value="{StaticResource SuccessBrush}" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding HasError}" Value="True">
                                        <Setter Property="Foreground" Value="{StaticResource ErrorBrush}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </StackPanel>

                <!-- Progress Bar -->
                <ProgressBar Grid.Row="1"
                             Height="4"
                             IsIndeterminate="{Binding IsRunning}"
                             Background="{StaticResource OverlayLight5Brush}"
                             Foreground="{StaticResource AccentBrush}"
                             BorderThickness="0"
                             Margin="0,0,0,12"
                             Visibility="{Binding IsRunning, Converter={StaticResource BoolToVisibilityConverter}}" />

                <!-- Output Console -->
                <Border Grid.Row="2"
                        Background="{StaticResource SurfaceBrush}"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1"
                        CornerRadius="4">
                    <ScrollViewer x:Name="OutputScrollViewer"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Auto">
                        <TextBox x:Name="OutputTextBox"
                                 Text="{Binding OutputContent, Mode=OneWay}"
                                 IsReadOnly="True"
                                 Background="Transparent"
                                 Foreground="{StaticResource PrimaryTextBrush}"
                                 FontFamily="{StaticResource MonoFontFamily}"
                                 FontSize="11"
                                 BorderThickness="0"
                                 Padding="12"
                                 TextWrapping="NoWrap"
                                 AcceptsReturn="True"
                                 VerticalScrollBarVisibility="Hidden"
                                 HorizontalScrollBarVisibility="Hidden" />
                    </ScrollViewer>
                </Border>
            </Grid>

            <!-- Buttons -->
            <Border Grid.Row="2"
                    Background="{StaticResource OverlayLight5Brush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="0,1,0,0"
                    Padding="16,12">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Exit Code / Duration -->
                    <StackPanel Grid.Column="0"
                                Orientation="Horizontal"
                                VerticalAlignment="Center"
                                Visibility="{Binding IsComplete, Converter={StaticResource BoolToVisibilityConverter}}">
                        <TextBlock Text="Exit code:"
                                   Foreground="{StaticResource MutedTextBrush}"
                                   FontFamily="{StaticResource MonoFontFamily}"
                                   FontSize="11"
                                   Margin="0,0,6,0" />
                        <TextBlock Text="{Binding ExitCode}"
                                   FontFamily="{StaticResource MonoFontFamily}"
                                   FontSize="11"
                                   Margin="0,0,16,0">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Foreground" Value="{StaticResource SuccessBrush}" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding HasError}" Value="True">
                                            <Setter Property="Foreground" Value="{StaticResource ErrorBrush}" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                        <TextBlock Text="Duration:"
                                   Foreground="{StaticResource MutedTextBrush}"
                                   FontFamily="{StaticResource MonoFontFamily}"
                                   FontSize="11"
                                   Margin="0,0,6,0" />
                        <TextBlock Text="{Binding DurationText}"
                                   Foreground="{StaticResource SecondaryTextBrush}"
                                   FontFamily="{StaticResource MonoFontFamily}"
                                   FontSize="11" />
                    </StackPanel>

                    <!-- Buttons -->
                    <StackPanel Grid.Column="1"
                                Orientation="Horizontal">
                        <Button Content="Cancel"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Click="CancelButton_Click"
                                MinWidth="80"
                                Margin="0,0,8,0"
                                Visibility="{Binding IsRunning, Converter={StaticResource BoolToVisibilityConverter}}" />
                        <Button Content="Close"
                                Style="{StaticResource PrimaryButtonStyle}"
                                Click="CloseButton_Click"
                                MinWidth="80"
                                IsDefault="True"
                                Visibility="{Binding IsComplete, Converter={StaticResource BoolToVisibilityConverter}}" />
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
