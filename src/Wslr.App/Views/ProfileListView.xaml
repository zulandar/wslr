<UserControl x:Class="Wslr.App.Views.ProfileListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="800"
             Loaded="OnLoaded">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="280" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- Left Panel: Profile List -->
        <Border Grid.Column="0"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,0,1,0"
                Background="{StaticResource SurfaceBrush}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Header -->
                <StackPanel Grid.Row="0" Margin="16,16,16,8">
                    <TextBlock Text="Configuration Profiles"
                               Style="{StaticResource SubtitleTextStyle}" />
                    <TextBlock Text="Quick-switch global WSL settings"
                               Style="{StaticResource CaptionTextStyle}"
                               Foreground="{StaticResource TextMutedBrush}"
                               Margin="0,4,0,0" />
                </StackPanel>

                <!-- Toolbar -->
                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="16,8,16,8">
                    <Button Content="New"
                            Command="{Binding NewProfileCommand}"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Padding="12,6"
                            Margin="0,0,8,0" />
                    <Button Content="Import"
                            Command="{Binding ImportProfileCommand}"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Padding="12,6" />
                </StackPanel>

                <!-- Profile List -->
                <ListBox Grid.Row="2"
                         ItemsSource="{Binding Profiles}"
                         SelectedItem="{Binding SelectedProfile}"
                         Background="Transparent"
                         BorderThickness="0"
                         Margin="8,0,8,8">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="12,10" />
                            <Setter Property="Margin" Value="0,2" />
                            <Setter Property="Background" Value="Transparent" />
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListBoxItem">
                                        <Border x:Name="Bd"
                                                Background="{TemplateBinding Background}"
                                                CornerRadius="4"
                                                Padding="{TemplateBinding Padding}">
                                            <ContentPresenter />
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="Bd" Property="Background" Value="{StaticResource SurfaceHoverBrush}" />
                                            </Trigger>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter TargetName="Bd" Property="Background" Value="{StaticResource PrimaryBrush}" />
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListBox.ItemContainerStyle>
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding Name}"
                                                   Style="{StaticResource BodyTextStyle}"
                                                   FontWeight="Medium" />
                                        <Border Background="#22C55E"
                                                CornerRadius="2"
                                                Padding="6,2"
                                                Margin="8,0,0,0"
                                                Visibility="{Binding IsActive, Converter={StaticResource BoolToVisibilityConverter}}">
                                            <TextBlock Text="Active"
                                                       FontSize="10"
                                                       Foreground="White" />
                                        </Border>
                                    </StackPanel>
                                    <TextBlock Text="{Binding Description}"
                                               Style="{StaticResource CaptionTextStyle}"
                                               Foreground="{StaticResource TextMutedBrush}"
                                               TextTrimming="CharacterEllipsis"
                                               Margin="0,2,0,0" />
                                    <Border Background="{StaticResource PrimaryBrush}"
                                            CornerRadius="2"
                                            Padding="6,2"
                                            Margin="0,4,0,0"
                                            HorizontalAlignment="Left"
                                            Visibility="{Binding IsBuiltIn, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <TextBlock Text="Built-in"
                                                   FontSize="10"
                                                   Foreground="White" />
                                    </Border>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>
        </Border>

        <!-- Right Panel: Details and Actions -->
        <ScrollViewer Grid.Column="1"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Padding="0,0,8,0">
            <StackPanel Margin="24,16,16,16" MaxWidth="500" HorizontalAlignment="Left">

                <!-- Success/Error Messages -->
                <Border Background="#1A4ADE80"
                        BorderBrush="#4ADE80"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="12,8"
                        Margin="0,0,0,16"
                        Visibility="{Binding SuccessMessage, Converter={StaticResource NullToVisibilityConverter}}">
                    <TextBlock Text="{Binding SuccessMessage}"
                               Foreground="#4ADE80"
                               TextWrapping="Wrap" />
                </Border>

                <Border Background="#1AF87171"
                        BorderBrush="#F87171"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="12,8"
                        Margin="0,0,0,16"
                        Visibility="{Binding ErrorMessage, Converter={StaticResource NullToVisibilityConverter}}">
                    <TextBlock Text="{Binding ErrorMessage}"
                               Foreground="#F87171"
                               TextWrapping="Wrap" />
                </Border>

                <!-- No Selection Message -->
                <TextBlock Text="Select a profile to view details, switch, or compare."
                           Style="{StaticResource BodyTextStyle}"
                           Foreground="{StaticResource TextMutedBrush}"
                           TextWrapping="Wrap"
                           Visibility="{Binding SelectedProfile, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Invert}" />

                <!-- Profile Details (when selected) -->
                <StackPanel Visibility="{Binding SelectedProfile, Converter={StaticResource NullToVisibilityConverter}}">

                    <!-- Normal View (not editing, not comparing) -->
                    <StackPanel>
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Visible" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsEditing}" Value="True">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IsComparing}" Value="True">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>

                        <!-- Profile Header -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="{Binding SelectedProfile.Name}"
                                       Style="{StaticResource SubtitleTextStyle}" />
                            <Border Background="#22C55E"
                                    CornerRadius="4"
                                    Padding="8,4"
                                    Margin="12,0,0,0"
                                    VerticalAlignment="Center"
                                    Visibility="{Binding SelectedProfile.IsActive, Converter={StaticResource BoolToVisibilityConverter}}">
                                <TextBlock Text="Active"
                                           FontSize="12"
                                           Foreground="White" />
                            </Border>
                        </StackPanel>
                        <TextBlock Text="{Binding SelectedProfile.Description}"
                                   Style="{StaticResource BodyTextStyle}"
                                   Foreground="{StaticResource TextMutedBrush}"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,16" />

                        <!-- Quick Switch -->
                        <Button Content="Switch to This Profile"
                                Command="{Binding SwitchToProfileCommand}"
                                Style="{StaticResource PrimaryButtonStyle}"
                                Padding="16,10"
                                Margin="0,0,0,24"
                                HorizontalAlignment="Left" />

                        <!-- Actions -->
                        <TextBlock Text="ACTIONS"
                                   Style="{StaticResource SettingsSectionHeaderStyle}" />

                        <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                            <Button Content="Edit"
                                    Command="{Binding EditProfileCommand}"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Padding="12,6"
                                    Margin="0,0,8,0" />
                            <Button Content="Duplicate"
                                    Command="{Binding DuplicateProfileCommand}"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Padding="12,6"
                                    Margin="0,0,8,0" />
                            <Button Content="Compare"
                                    Command="{Binding StartCompareCommand}"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Padding="12,6"
                                    Margin="0,0,8,0" />
                            <Button Content="Export"
                                    Command="{Binding ExportProfileCommand}"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Padding="12,6"
                                    Margin="0,0,8,0" />
                            <Button Content="Delete"
                                    Command="{Binding DeleteProfileCommand}"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Padding="12,6" />
                        </StackPanel>

                        <!-- Create from Current -->
                        <TextBlock Text="CREATE FROM CURRENT"
                                   Style="{StaticResource SettingsSectionHeaderStyle}"
                                   Margin="0,32,0,12" />

                        <TextBlock Text="Save your current .wslconfig settings as a new profile."
                                   Style="{StaticResource BodyTextStyle}"
                                   Foreground="{StaticResource TextMutedBrush}"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,12" />

                        <Button Content="Create Profile from Current Settings"
                                Command="{Binding CreateFromCurrentCommand}"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Padding="12,6"
                                HorizontalAlignment="Left" />
                    </StackPanel>

                    <!-- Edit Form -->
                    <StackPanel Visibility="{Binding IsEditing, Converter={StaticResource BoolToVisibilityConverter}}">
                        <TextBlock Text="Edit Profile"
                                   Style="{StaticResource SubtitleTextStyle}"
                                   Margin="0,0,0,16" />

                        <TextBlock Text="Name" Style="{StaticResource BodyTextStyle}" Margin="0,0,0,4" />
                        <TextBox Text="{Binding EditName, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource SettingsTextBoxStyle}"
                                 Margin="0,0,0,16" />

                        <TextBlock Text="Description" Style="{StaticResource BodyTextStyle}" Margin="0,0,0,4" />
                        <TextBox Text="{Binding EditDescription, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource SettingsTextBoxStyle}"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 MinHeight="80"
                                 Margin="0,0,0,16" />

                        <StackPanel Orientation="Horizontal">
                            <Button Content="Save"
                                    Command="{Binding SaveProfileCommand}"
                                    Style="{StaticResource PrimaryButtonStyle}"
                                    Padding="16,6"
                                    Margin="0,0,8,0" />
                            <Button Content="Cancel"
                                    Command="{Binding CancelEditCommand}"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Padding="12,6" />
                        </StackPanel>
                    </StackPanel>

                    <!-- Compare View -->
                    <StackPanel Visibility="{Binding IsComparing, Converter={StaticResource BoolToVisibilityConverter}}">
                        <TextBlock Text="Compare Profiles"
                                   Style="{StaticResource SubtitleTextStyle}"
                                   Margin="0,0,0,16" />

                        <TextBlock Style="{StaticResource BodyTextStyle}" Margin="0,0,0,8">
                            <Run Text="Comparing:" />
                            <Run Text="{Binding SelectedProfile.Name}" FontWeight="Bold" />
                        </TextBlock>

                        <TextBlock Text="Compare with:" Style="{StaticResource BodyTextStyle}" Margin="0,0,0,4" />
                        <ComboBox ItemsSource="{Binding Profiles}"
                                  SelectedItem="{Binding CompareProfile}"
                                  DisplayMemberPath="Name"
                                  Width="200"
                                  Style="{StaticResource SettingsComboBoxStyle}"
                                  Margin="0,0,0,16" />

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                            <Button Content="Compare"
                                    Command="{Binding CompareWithCommand}"
                                    Style="{StaticResource PrimaryButtonStyle}"
                                    Padding="16,6"
                                    Margin="0,0,8,0" />
                            <Button Content="Cancel"
                                    Command="{Binding ExitCompareCommand}"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Padding="12,6" />
                        </StackPanel>

                        <!-- Differences Table -->
                        <Border BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="4"
                                Visibility="{Binding Differences.Count, Converter={StaticResource CountToVisibilityConverter}}">
                            <DataGrid ItemsSource="{Binding Differences}"
                                      AutoGenerateColumns="False"
                                      IsReadOnly="True"
                                      HeadersVisibility="Column"
                                      GridLinesVisibility="Horizontal"
                                      Background="Transparent"
                                      BorderThickness="0"
                                      RowBackground="Transparent"
                                      AlternatingRowBackground="{StaticResource SurfaceBrush}">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Section" Binding="{Binding Section}" Width="100" />
                                    <DataGridTextColumn Header="Setting" Binding="{Binding Setting}" Width="150" />
                                    <DataGridTextColumn Header="Profile 1" Binding="{Binding Value1}" Width="*" />
                                    <DataGridTextColumn Header="Profile 2" Binding="{Binding Value2}" Width="*" />
                                </DataGrid.Columns>
                            </DataGrid>
                        </Border>
                    </StackPanel>
                </StackPanel>

            </StackPanel>
        </ScrollViewer>

        <!-- Loading overlay -->
        <Border Grid.ColumnSpan="2"
                Background="{StaticResource BackgroundBrush}"
                Opacity="0.9"
                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                Panel.ZIndex="100">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <TextBlock Text="Loading..."
                           Style="{StaticResource BodyTextStyle}"
                           HorizontalAlignment="Center" />
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
