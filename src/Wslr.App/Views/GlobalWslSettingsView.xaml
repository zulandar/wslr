<UserControl x:Class="Wslr.App.Views.GlobalWslSettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="600"
             Loaded="OnLoaded">

    <Grid>
        <!-- Loading overlay -->
        <Border Background="{StaticResource BackgroundBrush}"
                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                Panel.ZIndex="100">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <TextBlock Text="Loading configuration..."
                           Style="{StaticResource BodyTextStyle}"
                           HorizontalAlignment="Center" />
            </StackPanel>
        </Border>

        <ScrollViewer VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Padding="0,0,8,0">
            <StackPanel MaxWidth="600" HorizontalAlignment="Left">

                <!-- Header with Save/Cancel -->
                <Grid Margin="0,0,0,16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Global WSL Settings"
                                   Style="{StaticResource SubtitleTextStyle}" />
                        <TextBlock Text="{Binding ConfigPath}"
                                   Style="{StaticResource CaptionTextStyle}"
                                   Foreground="{StaticResource TextMutedBrush}"
                                   Margin="0,4,0,0" />
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Top">
                        <Button Content="Reset"
                                Command="{Binding ResetToDefaultsCommand}"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Margin="0,0,8,0"
                                Padding="12,6" />
                        <Button Content="Cancel"
                                Command="{Binding CancelCommand}"
                                IsEnabled="{Binding IsDirty}"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Margin="0,0,8,0"
                                Padding="12,6" />
                        <Button Content="Save"
                                Command="{Binding SaveCommand}"
                                IsEnabled="{Binding IsDirty}"
                                Style="{StaticResource PrimaryButtonStyle}"
                                Padding="16,6" />
                    </StackPanel>
                </Grid>

                <!-- Success/Error Messages -->
                <Border Background="#1A4ADE80"
                        BorderBrush="#4ADE80"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="12,8"
                        Margin="0,0,0,16"
                        Visibility="{Binding SuccessMessage, Converter={StaticResource NullToVisibilityConverter}}">
                    <TextBlock Text="{Binding SuccessMessage}"
                               Foreground="#4ADE80"
                               TextWrapping="Wrap" />
                </Border>

                <Border Background="#1AF87171"
                        BorderBrush="#F87171"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="12,8"
                        Margin="0,0,0,16"
                        Visibility="{Binding ErrorMessage, Converter={StaticResource NullToVisibilityConverter}}">
                    <TextBlock Text="{Binding ErrorMessage}"
                               Foreground="#F87171"
                               TextWrapping="Wrap" />
                </Border>

                <!-- Memory & CPU Section -->
                <TextBlock Text="MEMORY &amp; CPU"
                           Style="{StaticResource SettingsSectionHeaderStyle}" />

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Memory limit" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Maximum memory for WSL 2 VM (e.g., 8GB, 4096MB)"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <TextBox Grid.Column="1"
                                 Text="{Binding Memory, UpdateSourceTrigger=PropertyChanged}"
                                 Width="100"
                                 Style="{StaticResource SettingsTextBoxStyle}" />
                    </Grid>
                </Border>

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Processors" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0">
                                <Run Text="Number of logical processors (max:" />
                                <Run Text="{Binding MaxProcessors, Mode=OneWay}" />
                                <Run Text=")" />
                            </TextBlock>
                        </StackPanel>
                        <TextBox Grid.Column="1"
                                 Text="{Binding Processors, UpdateSourceTrigger=PropertyChanged, TargetNullValue=''}"
                                 Width="60"
                                 Style="{StaticResource SettingsTextBoxStyle}" />
                    </Grid>
                </Border>

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Swap size" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Swap space size (e.g., 8GB)"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <TextBox Grid.Column="1"
                                 Text="{Binding Swap, UpdateSourceTrigger=PropertyChanged}"
                                 Width="100"
                                 Style="{StaticResource SettingsTextBoxStyle}" />
                    </Grid>
                </Border>

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Page reporting" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Enable page reporting for memory reclamation"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <CheckBox Grid.Column="1"
                                  IsChecked="{Binding PageReporting}"
                                  Style="{StaticResource ToggleSwitchStyle}" />
                    </Grid>
                </Border>

                <!-- Networking Section -->
                <TextBlock Text="NETWORKING"
                           Style="{StaticResource SettingsSectionHeaderStyle}"
                           Margin="0,24,0,12" />

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Networking mode" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="NAT (default) or Mirrored networking"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <ComboBox Grid.Column="1"
                                  ItemsSource="{Binding NetworkingModes}"
                                  SelectedItem="{Binding NetworkingMode}"
                                  Width="120"
                                  Style="{StaticResource SettingsComboBoxStyle}" />
                    </Grid>
                </Border>

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Localhost forwarding" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Forward localhost ports between Windows and WSL"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <CheckBox Grid.Column="1"
                                  IsChecked="{Binding LocalhostForwarding}"
                                  Style="{StaticResource ToggleSwitchStyle}" />
                    </Grid>
                </Border>

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="DNS tunneling" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Enable DNS tunneling for WSL"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <CheckBox Grid.Column="1"
                                  IsChecked="{Binding DnsTunneling}"
                                  Style="{StaticResource ToggleSwitchStyle}" />
                    </Grid>
                </Border>

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Firewall" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Apply Windows Firewall rules to WSL"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <CheckBox Grid.Column="1"
                                  IsChecked="{Binding Firewall}"
                                  Style="{StaticResource ToggleSwitchStyle}" />
                    </Grid>
                </Border>

                <!-- Features Section -->
                <TextBlock Text="FEATURES"
                           Style="{StaticResource SettingsSectionHeaderStyle}"
                           Margin="0,24,0,12" />

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="GUI applications (WSLg)" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Enable Linux GUI application support"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <CheckBox Grid.Column="1"
                                  IsChecked="{Binding GuiApplications}"
                                  Style="{StaticResource ToggleSwitchStyle}" />
                    </Grid>
                </Border>

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Nested virtualization" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Enable nested virtualization in WSL VM"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <CheckBox Grid.Column="1"
                                  IsChecked="{Binding NestedVirtualization}"
                                  Style="{StaticResource ToggleSwitchStyle}" />
                    </Grid>
                </Border>

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Debug console" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Show debug console output window"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <CheckBox Grid.Column="1"
                                  IsChecked="{Binding DebugConsole}"
                                  Style="{StaticResource ToggleSwitchStyle}" />
                    </Grid>
                </Border>

                <!-- Experimental Section -->
                <TextBlock Text="EXPERIMENTAL"
                           Style="{StaticResource SettingsSectionHeaderStyle}"
                           Margin="0,24,0,12" />

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Auto memory reclaim" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Automatically reclaim unused memory"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <ComboBox Grid.Column="1"
                                  ItemsSource="{Binding AutoMemoryReclaimOptions}"
                                  SelectedItem="{Binding AutoMemoryReclaim}"
                                  Width="120"
                                  Style="{StaticResource SettingsComboBoxStyle}" />
                    </Grid>
                </Border>

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Sparse VHD" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Automatically compact VHD files to reclaim disk space"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <CheckBox Grid.Column="1"
                                  IsChecked="{Binding SparseVhd}"
                                  Style="{StaticResource ToggleSwitchStyle}" />
                    </Grid>
                </Border>

                <!-- Advanced Section -->
                <TextBlock Text="ADVANCED"
                           Style="{StaticResource SettingsSectionHeaderStyle}"
                           Margin="0,24,0,12" />

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="VM idle timeout (ms)" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Time before VM shuts down when idle"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <TextBox Grid.Column="1"
                                 Text="{Binding VmIdleTimeout, UpdateSourceTrigger=PropertyChanged, TargetNullValue=''}"
                                 Width="80"
                                 Style="{StaticResource SettingsTextBoxStyle}" />
                    </Grid>
                </Border>

                <Border Style="{StaticResource SettingsRowStyle}">
                    <StackPanel>
                        <TextBlock Text="Custom kernel path" Style="{StaticResource BodyTextStyle}" />
                        <TextBlock Text="Path to a custom Linux kernel"
                                   Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        <TextBox Text="{Binding KernelPath, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource SettingsTextBoxStyle}"
                                 Margin="0,8,0,0" />
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource SettingsRowStyle}" Margin="0,0,0,24">
                    <StackPanel>
                        <TextBlock Text="Kernel command line" Style="{StaticResource BodyTextStyle}" />
                        <TextBlock Text="Additional kernel boot parameters"
                                   Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        <TextBox Text="{Binding KernelCommandLine, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource SettingsTextBoxStyle}"
                                 Margin="0,8,0,0" />
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
