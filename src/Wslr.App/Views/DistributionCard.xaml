<UserControl x:Class="Wslr.App.Views.DistributionCard"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:Wslr.UI.ViewModels;assembly=Wslr.UI"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=vm:DistributionItemViewModel}">

    <Border x:Name="CardBorder"
            BorderThickness="1"
            CornerRadius="8"
            Padding="16"
            Cursor="Hand">
        <Border.Background>
            <SolidColorBrush x:Name="CardBackgroundBrush" Color="#0DFFFFFF" />
        </Border.Background>
        <Border.BorderBrush>
            <SolidColorBrush x:Name="CardBorderBrush" Color="#1AFFFFFF" />
        </Border.BorderBrush>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Row 0: Icon + Name + Status -->
            <DockPanel Grid.Row="0" Margin="0,0,0,8">
                <!-- Status dot -->
                <Ellipse DockPanel.Dock="Right"
                         Width="10" Height="10"
                         VerticalAlignment="Center"
                         Margin="8,0,0,0">
                    <Ellipse.Style>
                        <Style TargetType="Ellipse">
                            <Setter Property="Fill" Value="{StaticResource StoppedBrush}" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsRunning}" Value="True">
                                    <Setter Property="Fill" Value="{StaticResource RunningBrush}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Ellipse.Style>
                </Ellipse>

                <!-- Pin button -->
                <Button DockPanel.Dock="Right"
                        VerticalAlignment="Center"
                        Margin="4,0,0,0"
                        Padding="4"
                        Cursor="Hand"
                        Command="{Binding DataContext.TogglePinCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                        CommandParameter="{Binding}">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="Transparent" />
                            <Setter Property="BorderThickness" Value="0" />
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                Padding="{TemplateBinding Padding}">
                                            <ContentPresenter />
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{StaticResource OverlayLight10Brush}" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <TextBlock FontFamily="Segoe MDL2 Assets"
                               FontSize="12"
                               VerticalAlignment="Center">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Text" Value="&#xE840;" />
                                <Setter Property="Foreground" Value="{StaticResource SecondaryTextBrush}" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsPinned}" Value="True">
                                        <Setter Property="Text" Value="&#xE718;" />
                                        <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </Button>

                <!-- Icon placeholder (emoji or image) -->
                <Border Width="28" Height="28"
                        CornerRadius="6"
                        Background="{StaticResource OverlayLight10Brush}"
                        Margin="0,0,12,0">
                    <TextBlock Text="ðŸ§"
                               FontSize="16"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center" />
                </Border>

                <!-- Name and subtitle -->
                <StackPanel VerticalAlignment="Center">
                    <TextBlock Text="{Binding Name}"
                               Style="{StaticResource BodyStrongTextStyle}"
                               TextTrimming="CharacterEllipsis"
                               MaxWidth="180" />
                    <TextBlock Style="{StaticResource CaptionTextStyle}">
                        <Run Text="{Binding Version, Mode=OneWay}" />
                    </TextBlock>
                </StackPanel>
            </DockPanel>

            <!-- Row 1: Status badge (visible when running) -->
            <StackPanel Grid.Row="1"
                        Orientation="Horizontal"
                        Margin="0,0,0,12"
                        Visibility="{Binding IsRunning, Converter={StaticResource BoolToVisibilityConverter}}">
                <Border Background="{StaticResource RunningBackgroundBrush}"
                        CornerRadius="4"
                        Padding="8,4">
                    <TextBlock Text="running"
                               Foreground="{StaticResource RunningBrush}"
                               FontFamily="{StaticResource MonoFontFamily}"
                               FontSize="11"
                               FontWeight="Medium" />
                </Border>
            </StackPanel>

            <!-- Row 2: Action buttons (hidden by default, shown on hover) -->
            <StackPanel x:Name="ActionPanel"
                        Grid.Row="2"
                        Orientation="Horizontal"
                        Opacity="0">

                <!-- Running state buttons -->
                <StackPanel Orientation="Horizontal"
                            Visibility="{Binding IsRunning, Converter={StaticResource BoolToVisibilityConverter}}">
                    <Button Content="Terminal"
                            Style="{StaticResource PrimaryButtonStyle}"
                            Padding="12,6"
                            Margin="0,0,8,0"
                            FontSize="12" />
                    <Button Style="{StaticResource SecondaryButtonStyle}"
                            Padding="8,6"
                            ToolTip="Stop">
                        <TextBlock Text="&#xE71A;"
                                   FontFamily="Segoe MDL2 Assets"
                                   FontSize="12" />
                    </Button>
                </StackPanel>

                <!-- Stopped state buttons -->
                <StackPanel Orientation="Horizontal"
                            Visibility="{Binding IsRunning, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}">
                    <Button Style="{StaticResource SuccessButtonStyle}"
                            Padding="12,6"
                            FontSize="12">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#xE768;"
                                       FontFamily="Segoe MDL2 Assets"
                                       FontSize="12"
                                       VerticalAlignment="Center"
                                       Margin="0,0,6,0" />
                            <TextBlock Text="Start"
                                       VerticalAlignment="Center" />
                        </StackPanel>
                    </Button>
                </StackPanel>

                <!-- More menu (always) -->
                <Button Style="{StaticResource SecondaryButtonStyle}"
                        Padding="8,6"
                        Margin="8,0,0,0"
                        ToolTip="More options">
                    <TextBlock Text="&#xE712;"
                               FontFamily="Segoe MDL2 Assets"
                               FontSize="12" />
                </Button>
            </StackPanel>
        </Grid>

        <!-- Hover animation triggers -->
        <Border.Triggers>
            <EventTrigger RoutedEvent="MouseEnter">
                <BeginStoryboard>
                    <Storyboard>
                        <!-- Background: white/5% â†’ white/8% -->
                        <ColorAnimation Storyboard.TargetName="CardBackgroundBrush"
                                        Storyboard.TargetProperty="Color"
                                        To="#14FFFFFF"
                                        Duration="0:0:0.15">
                            <ColorAnimation.EasingFunction>
                                <CubicEase EasingMode="EaseOut" />
                            </ColorAnimation.EasingFunction>
                        </ColorAnimation>
                        <!-- Border: white/10% â†’ white/20% -->
                        <ColorAnimation Storyboard.TargetName="CardBorderBrush"
                                        Storyboard.TargetProperty="Color"
                                        To="#33FFFFFF"
                                        Duration="0:0:0.15">
                            <ColorAnimation.EasingFunction>
                                <CubicEase EasingMode="EaseOut" />
                            </ColorAnimation.EasingFunction>
                        </ColorAnimation>
                        <!-- Action panel fade in -->
                        <DoubleAnimation Storyboard.TargetName="ActionPanel"
                                         Storyboard.TargetProperty="Opacity"
                                         To="1"
                                         Duration="0:0:0.2">
                            <DoubleAnimation.EasingFunction>
                                <CubicEase EasingMode="EaseOut" />
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>
                    </Storyboard>
                </BeginStoryboard>
            </EventTrigger>
            <EventTrigger RoutedEvent="MouseLeave">
                <BeginStoryboard>
                    <Storyboard>
                        <!-- Background back to white/5% -->
                        <ColorAnimation Storyboard.TargetName="CardBackgroundBrush"
                                        Storyboard.TargetProperty="Color"
                                        To="#0DFFFFFF"
                                        Duration="0:0:0.15">
                            <ColorAnimation.EasingFunction>
                                <CubicEase EasingMode="EaseOut" />
                            </ColorAnimation.EasingFunction>
                        </ColorAnimation>
                        <!-- Border back to white/10% -->
                        <ColorAnimation Storyboard.TargetName="CardBorderBrush"
                                        Storyboard.TargetProperty="Color"
                                        To="#1AFFFFFF"
                                        Duration="0:0:0.15">
                            <ColorAnimation.EasingFunction>
                                <CubicEase EasingMode="EaseOut" />
                            </ColorAnimation.EasingFunction>
                        </ColorAnimation>
                        <!-- Action panel fade out -->
                        <DoubleAnimation Storyboard.TargetName="ActionPanel"
                                         Storyboard.TargetProperty="Opacity"
                                         To="0"
                                         Duration="0:0:0.1">
                            <DoubleAnimation.EasingFunction>
                                <CubicEase EasingMode="EaseOut" />
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>
                    </Storyboard>
                </BeginStoryboard>
            </EventTrigger>
        </Border.Triggers>
    </Border>
</UserControl>
