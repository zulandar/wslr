<UserControl x:Class="Wslr.App.Views.DistroSettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="600"
             Loaded="OnLoaded">

    <Grid>
        <!-- Loading overlay -->
        <Border Background="{StaticResource BackgroundBrush}"
                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                Panel.ZIndex="100">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <TextBlock Text="Loading configuration..."
                           Style="{StaticResource BodyTextStyle}"
                           HorizontalAlignment="Center" />
            </StackPanel>
        </Border>

        <ScrollViewer VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Padding="0,0,8,0">
            <StackPanel MaxWidth="600" HorizontalAlignment="Left">

                <!-- Header with Save/Cancel -->
                <Grid Margin="0,0,0,16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Distribution Settings"
                                   Style="{StaticResource SubtitleTextStyle}" />
                        <TextBlock Text="{Binding ConfigPath}"
                                   Style="{StaticResource CaptionTextStyle}"
                                   Foreground="{StaticResource TextMutedBrush}"
                                   Margin="0,4,0,0" />
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Top">
                        <Button Content="Reset"
                                Command="{Binding ResetToDefaultsCommand}"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Margin="0,0,8,0"
                                Padding="12,6" />
                        <Button Content="Cancel"
                                Command="{Binding CancelCommand}"
                                IsEnabled="{Binding IsDirty}"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Margin="0,0,8,0"
                                Padding="12,6" />
                        <Button Content="Save"
                                Command="{Binding SaveCommand}"
                                IsEnabled="{Binding IsDirty}"
                                Style="{StaticResource PrimaryButtonStyle}"
                                Padding="16,6" />
                    </StackPanel>
                </Grid>

                <!-- Distribution Selector -->
                <Border Style="{StaticResource SettingsRowStyle}" Margin="0,0,0,16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Distribution" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Select a distribution to configure"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <ComboBox Grid.Column="1"
                                  ItemsSource="{Binding Distributions}"
                                  SelectedItem="{Binding SelectedDistribution}"
                                  Width="200"
                                  Style="{StaticResource SettingsComboBoxStyle}" />
                    </Grid>
                </Border>

                <!-- Success/Error Messages -->
                <Border Background="#1A4ADE80"
                        BorderBrush="#4ADE80"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="12,8"
                        Margin="0,0,0,16"
                        Visibility="{Binding SuccessMessage, Converter={StaticResource NullToVisibilityConverter}}">
                    <TextBlock Text="{Binding SuccessMessage}"
                               Foreground="#4ADE80"
                               TextWrapping="Wrap" />
                </Border>

                <Border Background="#1AF87171"
                        BorderBrush="#F87171"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="12,8"
                        Margin="0,0,0,16"
                        Visibility="{Binding ErrorMessage, Converter={StaticResource NullToVisibilityConverter}}">
                    <TextBlock Text="{Binding ErrorMessage}"
                               Foreground="#F87171"
                               TextWrapping="Wrap" />
                </Border>

                <!-- Automount Section -->
                <TextBlock Text="AUTOMOUNT"
                           Style="{StaticResource SettingsSectionHeaderStyle}" />

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Enable automount" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Automatically mount Windows drives"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <CheckBox Grid.Column="1"
                                  IsChecked="{Binding AutomountEnabled}"
                                  Style="{StaticResource ToggleSwitchStyle}" />
                    </Grid>
                </Border>

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Mount root" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Root directory for Windows drive mounts"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <TextBox Grid.Column="1"
                                 Text="{Binding AutomountRoot, UpdateSourceTrigger=PropertyChanged}"
                                 Width="120"
                                 Style="{StaticResource SettingsTextBoxStyle}" />
                    </Grid>
                </Border>

                <Border Style="{StaticResource SettingsRowStyle}">
                    <StackPanel>
                        <TextBlock Text="Mount options" Style="{StaticResource BodyTextStyle}" />
                        <TextBlock Text="Mount options (e.g., metadata,umask=22,fmask=11)"
                                   Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        <TextBox Text="{Binding AutomountOptions, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource SettingsTextBoxStyle}"
                                 Margin="0,8,0,0" />
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Process /etc/fstab" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Mount entries from fstab on startup"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <CheckBox Grid.Column="1"
                                  IsChecked="{Binding MountFsTab}"
                                  Style="{StaticResource ToggleSwitchStyle}" />
                    </Grid>
                </Border>

                <!-- Network Section -->
                <TextBlock Text="NETWORK"
                           Style="{StaticResource SettingsSectionHeaderStyle}"
                           Margin="0,24,0,12" />

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Generate /etc/hosts" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Auto-generate hosts file with Windows hostname"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <CheckBox Grid.Column="1"
                                  IsChecked="{Binding GenerateHosts}"
                                  Style="{StaticResource ToggleSwitchStyle}" />
                    </Grid>
                </Border>

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Generate /etc/resolv.conf" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Auto-generate DNS configuration"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <CheckBox Grid.Column="1"
                                  IsChecked="{Binding GenerateResolvConf}"
                                  Style="{StaticResource ToggleSwitchStyle}" />
                    </Grid>
                </Border>

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Hostname" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Custom hostname for this distribution"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <TextBox Grid.Column="1"
                                 Text="{Binding Hostname, UpdateSourceTrigger=PropertyChanged}"
                                 Width="150"
                                 Style="{StaticResource SettingsTextBoxStyle}" />
                    </Grid>
                </Border>

                <!-- Interop Section -->
                <TextBlock Text="INTEROP"
                           Style="{StaticResource SettingsSectionHeaderStyle}"
                           Margin="0,24,0,12" />

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Enable Windows interop" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Run Windows executables from Linux"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <CheckBox Grid.Column="1"
                                  IsChecked="{Binding InteropEnabled}"
                                  Style="{StaticResource ToggleSwitchStyle}" />
                    </Grid>
                </Border>

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Append Windows PATH" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Add Windows PATH to Linux $PATH"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <CheckBox Grid.Column="1"
                                  IsChecked="{Binding AppendWindowsPath}"
                                  Style="{StaticResource ToggleSwitchStyle}" />
                    </Grid>
                </Border>

                <!-- User Section -->
                <TextBlock Text="USER"
                           Style="{StaticResource SettingsSectionHeaderStyle}"
                           Margin="0,24,0,12" />

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Default user" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="User to log in as when launching"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <TextBox Grid.Column="1"
                                 Text="{Binding DefaultUser, UpdateSourceTrigger=PropertyChanged}"
                                 Width="150"
                                 Style="{StaticResource SettingsTextBoxStyle}" />
                    </Grid>
                </Border>

                <!-- Boot Section -->
                <TextBlock Text="BOOT"
                           Style="{StaticResource SettingsSectionHeaderStyle}"
                           Margin="0,24,0,12" />

                <Border Style="{StaticResource SettingsRowStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Enable systemd" Style="{StaticResource BodyTextStyle}" />
                            <TextBlock Text="Start systemd as init system"
                                       Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        </StackPanel>
                        <CheckBox Grid.Column="1"
                                  IsChecked="{Binding SystemdEnabled}"
                                  Style="{StaticResource ToggleSwitchStyle}" />
                    </Grid>
                </Border>

                <Border Style="{StaticResource SettingsRowStyle}" Margin="0,0,0,24">
                    <StackPanel>
                        <TextBlock Text="Boot command" Style="{StaticResource BodyTextStyle}" />
                        <TextBlock Text="Command to run on boot (runs as root)"
                                   Style="{StaticResource CaptionTextStyle}" Margin="0,4,0,0" />
                        <TextBox Text="{Binding BootCommand, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource SettingsTextBoxStyle}"
                                 Margin="0,8,0,0" />
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
